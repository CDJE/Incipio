{% extends 'FrontBundle:CRUD:index.html.twig' %}

{% block page_header_title -%}
    <h1>Utilisateurs</h1>
{%- endblock %}

{% block page_header_button -%}
    {{ macros.button_entity_new(path('users_new'), 'Nouveau membre') }}
{%- endblock %}

{% block sub_body -%}

    <div class="row">
        <div class="pull-left">
            <div class="form-inline">
                <label for="users-mandate-list">Mandat:</label>
                <select class="form-control" id="users-mandate-list">
                    {%- for mandate in mandates -%}
                        <option value="{{  mandate['@id'] }}">{{ mandate.name }}</option>
                    {%- endfor -%}
                </select>
            </div>
        </div>
        <div class="pull-left" style="margin-left: 10px">
            <div class="form-inline">
                <label for="users-type-list">Type:</label>
                <select class="form-control" id="users-type-list">
                    <option value="-1">Tous</option>
                    <option value="0">Membres</option>
                    <option value="1">Intervenants</option>
                </select>
            </div>
        </div>
    </div>
    <br />
    <div class="row">
        <table class="table table-head-bordered table-hover table-responsive table-striped table-vcentered" id="users-index-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Type</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for user in users %}
                <tr class="clickable"
                    onclick="window.location='{{ path('users_show', { 'id': user['@id']|uriId }) }}'">
                    <td>{{ user['@id']|uriId }}</td>
                    <td>
                        {%- if user.fullname is not null -%}
                            {{ user.fullname }}
                        {%- else -%}
                            {{ user.username }}
                        {%- endif -%}
                    </td>
                    <td>{{ user.email }}</td>
                    <td>
                        {%- set role = user.roles|userTopRole -%}
                        {%- if 'root' == role -%}
                            {% set class = 'label label-danger' -%}
                        {%- elseif 'admin' == role -%}
                            {% set class = 'label label-primary' -%}
                        {%- else %}
                            {% set class = 'label label-default' -%}
                        {%- endif -%}
                        <span class="{{ class }}">{{ role }}</span>
                    </td>
                    <td>
                        {% dump(user.types) %}
                        {%- for type in user.types -%}
                            {%- if 1 == type -%} {# 1 === contractor #}
                                {%- set class = 'label label-info' -%}
                                {%- set type = 'intervenant' -%}
                            {%- else %}
                                {% set class = 'label label-default' -%}
                                {%- set type = 'membre' -%}
                            {%- endif -%}
                            <span class="{{ class }}">{{ type }}</span>
                        {%- endfor -%}
                    </td>
                    <td>
                        {{ macros.button_entity_show(path('users_show', { 'id': user['@id']|uriId })) }}
                        {{ macros.button_entity_edit(path('users_edit', { 'id': user['@id']|uriId })) }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{%- endblock %}
